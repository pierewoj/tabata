<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabata Workout Timer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: background-color 0.5s ease;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            padding: 20px;
            position: relative;
        }

        .app-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 20px;
            transition: opacity 0.3s ease;
        }

        .app-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
            margin: 0;
        }

        .app-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 20px;
            transition: opacity 0.3s ease;
        }

        .app-footer p {
            margin: 5px 0;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .app-footer a {
            color: #FFD700;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }

        .app-footer a:hover {
            color: #FFA000;
            text-decoration: underline;
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
        }

        .workout-phase {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .rest-phase {
            background: linear-gradient(135deg, #FF9800, #f57c00);
        }

        .stopped {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }

        .config-mode {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
        }

        .container {
            text-align: center;
            padding: 20px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 400px;
            max-width: 800px;
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        .timer-display {
            font-size: 8rem;
            font-weight: bold;
            margin: 20px 0;
            text-align: center;
            letter-spacing: -5px;
        }

        .exercise-name {
            font-size: 2.5rem;
            margin: 20px 0;
            font-weight: bold;
        }

        .exercise-info {
            font-size: 1.5rem;
            margin: 10px 0;
            opacity: 0.9;
        }

        .no-exercises-message {
            font-size: 1.8rem;
            margin: 30px 0;
            color: #FFD700;
            font-weight: bold;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.7);
        }

        .next-exercise {
            font-size: 1.2rem;
            margin: 15px 0;
            opacity: 0.8;
            font-style: italic;
        }

        .controls {
            margin: 30px 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .main-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        button {
            font-size: 1.2rem;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: rgba(128,128,128,0.3);
            color: rgba(255,255,255,0.4);
            cursor: not-allowed;
            transform: none;
        }

        /* Button color variants */
        .btn-start {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border: 2px solid #4CAF50;
        }

        .btn-start:hover:not(:disabled) {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-2px);
        }

        .btn-stop {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            border: 2px solid #f44336;
        }

        .btn-stop:hover:not(:disabled) {
            background: linear-gradient(135deg, #d32f2f, #c62828);
            transform: translateY(-2px);
        }

        .btn-pause {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            border: 2px solid #FF9800;
        }

        .btn-pause:hover:not(:disabled) {
            background: linear-gradient(135deg, #F57C00, #EF6C00);
            transform: translateY(-2px);
        }

        .btn-config-highlight {
            background: linear-gradient(135deg, #FFD700, #FFA000) !important;
            border: 3px solid #FFD700 !important;
            color: #333 !important;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }

        .phase-indicator {
            font-size: 1.8rem;
            margin: 15px 0;
            font-weight: bold;
            text-transform: uppercase;
        }

        .total-time {
            font-size: 1.1rem;
            margin: 10px 0;
            opacity: 0.8;
        }

        /* Configuration Styles */
        .config-container {
            display: none;
            text-align: left;
            max-height: 70vh;
            overflow-y: auto;
            color: white;
        }

        .config-container.active {
            display: block;
        }

        .config-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .config-title {
            font-size: 2rem;
            margin-bottom: 10px;
            color: white;
            font-weight: bold;
        }

        .exercise-list {
            margin: 20px 0;
        }

        .rest-config {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .rest-config-item {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .exercise-item {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            margin: 10px 0;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .exercise-number {
            font-weight: bold;
            margin-right: 15px;
            min-width: 40px;
            color: white;
        }

        .exercise-input {
            flex: 1;
            padding: 10px;
            margin-right: 15px;
            color: black;
            border: none;
            border-radius: 5px;
        }

        .duration-input {
            width: 60px;
            padding: 8px;
            margin-right: 5px;
            color: black;
            text-align: center;
            border: none;
            border-radius: 5px;
        }

        .move-btn {
            width: 35px;
            height: 35px;
            border-radius: 5px;
            font-size: 14px;
            margin-right: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .remove-btn {
            background: rgba(244, 67, 54, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .remove-btn:hover {
            background: rgba(244, 67, 54, 1);
            transform: scale(1.1);
        }

        .add-exercise {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .add-btn {
            background: rgba(76, 175, 80, 0.8);
            color: white;
            padding: 12px 25px;
            font-size: 1rem;
        }

        .add-btn:hover {
            background: rgba(76, 175, 80, 1);
        }

        .config-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }

        /* Hide number input arrows */
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
        }

        @media (max-width: 500px) {
            .container {
                min-width: 300px;
                padding: 15px;
            }
            
            .timer-display {
                font-size: 5rem;
            }
            
            .exercise-name {
                font-size: 1.8rem;
            }

            .config-actions {
                flex-direction: column;
            }

            .main-controls, .nav-controls {
                flex-direction: column;
            }

            .app-title {
                font-size: 2rem;
            }

            .app-footer p {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body class="stopped">
    <!-- Header -->
    <header class="app-header" id="appHeader">
        <h1 class="app-title">Tabata Timer App</h1>
    </header>

    <!-- Timer View -->
    <div class="container" id="timerContainer">
        <div class="phase-indicator" id="phaseIndicator">NO CONFIGURATION</div>
        <div class="timer-display" id="timerDisplay">0:00</div>
        <div class="exercise-name" id="exerciseName">No exercises</div>
        <div class="exercise-info" id="exerciseInfo">Configure workout</div>
        <div class="no-exercises-message" id="noExercisesMessage" style="display: none;">
            No exercises - press the CONFIG button to configure workout
        </div>
        <div class="next-exercise" id="nextExercise"></div>
        <div class="total-time" id="totalTime">Total time: 0:00</div>
        
        <div class="controls">
            <div class="main-controls">
                <button id="startBtn" class="btn-start" onclick="startWorkout()" style="display: none;">START</button>
                <button id="pauseBtn" class="btn-pause" onclick="pauseWorkout()" style="display: none;">PAUSE</button>
                <button id="stopBtn" class="btn-stop" onclick="stopWorkout()" style="display: none;">STOP</button>
                <button id="configBtn" onclick="showConfig()">CONFIG</button>
                <button id="copyLinkBtn" onclick="copyWorkoutLink()">COPY LINK</button>
            </div>
            
            <div class="nav-controls" id="navControls" style="display: none;">
                <button id="prevExerciseBtn" onclick="previousExercise()">⏮️ PREVIOUS</button>
                <button id="nextExerciseBtn" onclick="nextExercise()">NEXT ⏭️</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="app-footer" id="appFooter">
        <p>Free • No Ads • No Tracking • Open Source</p>
        <p>Created by <a href="https://github.com/pierewoj" target="_blank" rel="noopener noreferrer">pierewoj</a></p>
    </footer>

    <!-- Configuration View -->
    <div class="container config-container" id="configContainer">
        <div class="config-header">
            <div class="config-title">Workout Configuration</div>
            <div>Add, remove, edit or reorder exercises</div>
        </div>

        <div class="rest-config">
            <div class="rest-config-item">
                <label for="restTimeInput" style="color: white; font-weight: bold; margin-right: 15px;">Rest between exercises:</label>
                <input type="number" id="restTimeInput" class="duration-input" min="0" max="60" style="margin-right: 10px;">
                <span style="color: white;">seconds</span>
            </div>
        </div>

        <div class="exercise-list" id="exerciseList">
            <!-- Exercises will be populated here -->
        </div>

        <div class="add-exercise">
            <button class="add-btn" onclick="addExercise()">+ ADD EXERCISE</button>
        </div>

        <div class="config-actions">
            <button onclick="saveConfig()">SAVE & RETURN</button>
            <button onclick="cancelConfig()">CANCEL</button>
        </div>
    </div>

    <script>
        // App state
        let exercises = [];
        let tempExercises = [];
        let currentExerciseIndex = 0;
        let timeRemaining = 0;
        let isRunning = false;
        let isPaused = false;
        let isResting = false;
        let restTime = 5;
        let timer = null;
        let audioContext = null;

        // Audio functions
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playBeep(frequency = 800, duration = 200) {
            initAudio();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration / 1000);
        }

        // Utility functions
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function calculateRemainingTime() {
            let remainingTotal = 0;
            for (let i = currentExerciseIndex; i < exercises.length; i++) {
                remainingTotal += exercises[i].duration;
            }
            if (currentExerciseIndex < exercises.length - 1) {
                remainingTotal += (exercises.length - currentExerciseIndex - 1) * restTime;
            }
            if (exercises[currentExerciseIndex]) {
                remainingTotal -= (exercises[currentExerciseIndex].duration - timeRemaining);
            }
            return remainingTotal;
        }

        // Display functions
        function updateDisplay() {
            const elements = {
                timer: document.getElementById('timerDisplay'),
                exerciseName: document.getElementById('exerciseName'),
                exerciseInfo: document.getElementById('exerciseInfo'),
                nextExercise: document.getElementById('nextExercise'),
                phaseIndicator: document.getElementById('phaseIndicator'),
                totalTime: document.getElementById('totalTime'),
                noExercisesMessage: document.getElementById('noExercisesMessage')
            };

            if (exercises.length === 0) {
                elements.timer.textContent = "0:00";
                elements.exerciseName.textContent = "";
                elements.exerciseInfo.textContent = "";
                elements.nextExercise.textContent = "";
                elements.phaseIndicator.textContent = "NO CONFIGURATION";
                elements.totalTime.textContent = "Total time: 0:00";
                elements.noExercisesMessage.style.display = "block";
                updateButtonVisibility();
                return;
            } else {
                elements.noExercisesMessage.style.display = "none";
            }

            elements.timer.textContent = formatTime(timeRemaining);

            if (isResting) {
                elements.phaseIndicator.textContent = "REST";
                elements.exerciseName.textContent = "Get ready...";
                elements.exerciseInfo.textContent = `Next exercise in ${timeRemaining}s`;
            } else {
                elements.phaseIndicator.textContent = isRunning ? "WORKOUT" : "READY TO TRAIN";
                elements.exerciseName.textContent = exercises[currentExerciseIndex]?.name || "";
                elements.exerciseInfo.textContent = `Exercise ${currentExerciseIndex + 1}/${exercises.length}`;
            }

            // Show next exercise
            if (currentExerciseIndex < exercises.length - 1) {
                elements.nextExercise.textContent = `Next: ${exercises[currentExerciseIndex + 1].name}`;
            } else {
                elements.nextExercise.textContent = "This is the last exercise!";
            }

            // Show remaining time
            const remainingTime = calculateRemainingTime();
            elements.totalTime.textContent = `Remaining time: ${formatTime(remainingTime)}`;

            updateButtonVisibility();
        }

        function updateButtonVisibility() {
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const stopBtn = document.getElementById('stopBtn');
            const configBtn = document.getElementById('configBtn');
            const copyLinkBtn = document.getElementById('copyLinkBtn');
            const navControls = document.getElementById('navControls');

            if (exercises.length === 0) {
                // No exercises - show only config button (highlighted)
                startBtn.style.display = 'none';
                pauseBtn.style.display = 'none';
                stopBtn.style.display = 'none';
                configBtn.style.display = 'inline-block';
                configBtn.classList.add('btn-config-highlight');
                copyLinkBtn.style.display = 'inline-block';
                navControls.style.display = 'none';
            } else {
                configBtn.classList.remove('btn-config-highlight');
                
                if (!isRunning && !isPaused) {
                    // Stopped state - show start, config, copy link buttons, hide navigation
                    startBtn.style.display = 'inline-block';
                    pauseBtn.style.display = 'none';
                    stopBtn.style.display = 'none';
                    configBtn.style.display = 'inline-block';
                    copyLinkBtn.style.display = 'inline-block';
                    navControls.style.display = 'none';
                } else if (isRunning) {
                    // Running state - show pause, stop and navigation buttons only
                    startBtn.style.display = 'none';
                    pauseBtn.style.display = 'inline-block';
                    stopBtn.style.display = 'inline-block';
                    configBtn.style.display = 'none';
                    copyLinkBtn.style.display = 'none';
                    navControls.style.display = 'flex';
                } else if (isPaused) {
                    // Paused state - show start, stop and navigation buttons only
                    startBtn.style.display = 'inline-block';
                    pauseBtn.style.display = 'none';
                    stopBtn.style.display = 'inline-block';
                    configBtn.style.display = 'none';
                    copyLinkBtn.style.display = 'none';
                    navControls.style.display = 'flex';
                }
            }

            // Update navigation button states
            const prevBtn = document.getElementById('prevExerciseBtn');
            const nextBtn = document.getElementById('nextExerciseBtn');
            
            if (exercises.length > 0) {
                prevBtn.disabled = currentExerciseIndex === 0;
                nextBtn.disabled = currentExerciseIndex === 0 && isResting;
                nextBtn.disabled = currentExerciseIndex === exercises.length - 1;
            }
        }

        function updateHeaderFooterVisibility() {
            const header = document.getElementById('appHeader');
            const footer = document.getElementById('appFooter');
            const isConfigActive = document.getElementById('configContainer').style.display === 'block';
            
            // Show header and footer only when workout is not running and not in config mode
            const shouldShow = !isRunning && !isPaused && !isConfigActive;
            
            if (shouldShow) {
                header.classList.remove('hidden');
                footer.classList.remove('hidden');
            } else {
                header.classList.add('hidden');
                footer.classList.add('hidden');
            }
        }

        function updateBackground() {
            const body = document.body;
            body.className = '';
            
            const isConfigActive = document.getElementById('configContainer').style.display === 'block';
            
            if (isConfigActive) {
                body.classList.add('config-mode');
            } else if (!isRunning) {
                body.classList.add('stopped');
            } else if (isResting) {
                body.classList.add('rest-phase');
            } else {
                body.classList.add('workout-phase');
            }
            
            updateHeaderFooterVisibility();
        }

        // Timer control functions
        function startWorkout() {
            if (exercises.length === 0) {
                alert('Please configure your workout first!');
                return;
            }

            isRunning = true;
            isPaused = false;
            startTimer();
            playBeep(800, 300); // Start beep
            updateDisplay();
            updateBackground();
        }

        function pauseWorkout() {
            isRunning = false;
            isPaused = true;
            
            if (timer) {
                clearInterval(timer);
                timer = null;
            }
            
            updateDisplay();
            updateBackground();
        }

        function stopWorkout() {
            isRunning = false;
            isPaused = false;
            isResting = false;
            currentExerciseIndex = 0;
            timeRemaining = exercises.length > 0 ? exercises[0].duration : 0;
            
            if (timer) {
                clearInterval(timer);
                timer = null;
            }
            
            updateDisplay();
            updateBackground();
        }

        function previousExercise() {
            if (currentExerciseIndex > 0) {
                currentExerciseIndex--;
                timeRemaining = exercises[currentExerciseIndex].duration;
                isResting = false;
                updateDisplay();
            }
        }

        function nextExercise() {
            if (currentExerciseIndex < exercises.length - 1) {
                currentExerciseIndex++;
                timeRemaining = exercises[currentExerciseIndex].duration;
                isResting = false;
                updateDisplay();
            }
        }

        function startTimer() {
            timer = setInterval(() => {
                timeRemaining--;
                updateDisplay();
                
                if (timeRemaining <= 0) {
                    if (isResting) {
                        // Rest finished, start next exercise
                        isResting = false;
                        currentExerciseIndex++;
                        
                        if (currentExerciseIndex >= exercises.length) {
                            alert('Workout completed! Congratulations!');
                            stopWorkout();
                            return;
                        }
                        
                        timeRemaining = exercises[currentExerciseIndex].duration;
                        playBeep(800, 300); // Start exercise beep
                        updateBackground();
                    } else {
                        // Exercise finished
                        if (currentExerciseIndex < exercises.length - 1) {
                            // Start rest period
                            isResting = true;
                            timeRemaining = restTime;
                            playBeep(400, 500); // Rest beep
                            updateBackground();
                        } else {
                            // Workout completed
                            alert('Workout completed! Congratulations!');
                            stopWorkout();
                            return;
                        }
                    }
                }
            }, 1000);
        }

        // Configuration functions
        function showConfig() {
            if (isRunning) {
                alert('Please stop the workout before configuring!');
                return;
            }

            document.getElementById('timerContainer').style.display = 'none';
            document.getElementById('configContainer').style.display = 'block';
            
            tempExercises = exercises.map(ex => ({...ex}));
            document.getElementById('restTimeInput').value = restTime;
            renderConfigList();
            updateBackground();
        }

        function hideConfig() {
            document.getElementById('timerContainer').style.display = 'block';
            document.getElementById('configContainer').style.display = 'none';
            updateBackground();
        }

        function renderConfigList() {
            const list = document.getElementById('exerciseList');
            list.innerHTML = '';

            tempExercises.forEach((exercise, index) => {
                const item = document.createElement('div');
                item.className = 'exercise-item';

                const isFirst = index === 0;
                const isLast = index === tempExercises.length - 1;

                item.innerHTML = `
                    <div class="exercise-number">${index + 1}.</div>
                    <input type="text" class="exercise-input" value="${exercise.name}" 
                           maxlength="100" onchange="updateExerciseName(${index}, this.value)">
                    <input type="number" class="duration-input" value="${exercise.duration}" 
                           min="5" max="600" onchange="updateExerciseDuration(${index}, this.value)">
                    <span style="color: white; margin-right: 15px;">s</span>
                    <button class="move-btn" onclick="moveExerciseUp(${index})" ${isFirst ? 'disabled' : ''}>⬆️</button>
                    <button class="move-btn" onclick="moveExerciseDown(${index})" ${isLast ? 'disabled' : ''}>⬇️</button>
                    <button class="remove-btn" onclick="removeExercise(${index})">🗑️</button>
                `;

                list.appendChild(item);
            });
        }

        function updateExerciseName(index, name) {
            tempExercises[index].name = name;
        }

        function updateExerciseDuration(index, duration) {
            const newDuration = Math.max(5, Math.min(600, parseInt(duration) || 60));
            tempExercises[index].duration = newDuration;
        }

        function moveExerciseUp(index) {
            if (index === 0) return;
            [tempExercises[index - 1], tempExercises[index]] = [tempExercises[index], tempExercises[index - 1]];
            renderConfigList();
        }

        function moveExerciseDown(index) {
            if (index === tempExercises.length - 1) return;
            [tempExercises[index], tempExercises[index + 1]] = [tempExercises[index + 1], tempExercises[index]];
            renderConfigList();
        }

        function addExercise() {
            tempExercises.push({ name: "New Exercise", duration: 60 });
            renderConfigList();
        }

        function removeExercise(index) {
            tempExercises.splice(index, 1);
            renderConfigList();
        }

        function saveConfig() {
            exercises = tempExercises.map(ex => ({...ex}));
            const newRestTime = parseInt(document.getElementById('restTimeInput').value);
            if (newRestTime >= 0 && newRestTime <= 60) {
                restTime = newRestTime;
            }
            stopWorkout();
            updateDisplay();
            hideConfig();
        }

        function cancelConfig() {
            hideConfig();
        }

        // URL sharing functions
        function encodeConfig(exercises) {
            try {
                return encodeURIComponent(JSON.stringify({ exercises, restTime }));
            } catch (e) {
                console.error('Error encoding config:', e);
                return '';
            }
        }

        function decodeConfig(encoded) {
            try {
                const decoded = JSON.parse(decodeURIComponent(encoded));
                // Handle both old format (array) and new format (object)
                if (Array.isArray(decoded)) {
                    return { exercises: decoded, restTime: 5 }; // Default rest time for old format
                }
                return decoded;
            } catch (e) {
                console.error('Error decoding config:', e);
                return null;
            }
        }

        function copyWorkoutLink() {
            if (exercises.length === 0) {
                alert('Please add some exercises first!');
                return;
            }
            
            const encoded = encodeConfig(exercises);
            const shareUrl = `${window.location.origin}${window.location.pathname}#${encoded}`;
            
            // Try modern clipboard API first
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(shareUrl).then(() => {
                    alert('Workout link copied to clipboard!');
                }).catch(() => {
                    // Fallback to old method
                    fallbackCopyToClipboard(shareUrl);
                });
            } else {
                fallbackCopyToClipboard(shareUrl);
            }
        }

        function fallbackCopyToClipboard(text) {
            // Create a temporary textarea element
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('Workout link copied to clipboard!');
            } catch (err) {
                alert('Could not copy link. Please copy manually: ' + text);
            }
            
            document.body.removeChild(textArea);
        }

        function loadConfigFromUrl() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                const decoded = decodeConfig(hash);
                if (decoded) {
                    if (decoded.exercises && Array.isArray(decoded.exercises) && decoded.exercises.length > 0) {
                        exercises = decoded.exercises.map(ex => ({
                            name: ex.name || "Exercise",
                            duration: parseInt(ex.duration) || 60
                        }));
                        if (decoded.restTime !== undefined) {
                            restTime = Math.max(0, Math.min(60, parseInt(decoded.restTime) || 5));
                        }
                        return true;
                    }
                }
            }
            return false;
        }

        // Initialize app
        function init() {
            if (!loadConfigFromUrl()) {
                exercises = []; // Start with empty exercise list if no URL config
            }
            currentExerciseIndex = 0;
            timeRemaining = exercises.length > 0 ? exercises[0].duration : 0;
            updateDisplay();
            updateBackground();
        }

        // Start the app
        init();
    </script>
</body>
</html>